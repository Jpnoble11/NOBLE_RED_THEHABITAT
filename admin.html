<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Page - The Habitat</title>

    <!-- Bootstrap CSS (you may need to adjust the path) -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />

    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 800px;
        margin: 50px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #343a40;
      }

      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
      }

      th {
        background-color: #007bff;
        color: #fff;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      .btn {
        padding: 6px 12px;
        margin-bottom: 0;
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        border: 1px solid transparent;
        border-radius: 4px;
      }

      .btn-danger {
        color: #fff;
        background-color: #dc3545;
        border-color: #dc3545;
      }
    </style>
  </head>

  <body>
    <div class="container mt-5">
      <h2>Reservation Management</h2>
      <div id="totalReservations" class="mt-3">
        <strong
          >Total Reservations for Today: <span id="totalCount">0</span></strong
        >
      </div>

      <!-- Display dates with max reservations -->
      <div id="maxReservedDates" class="mt-3">
        <strong>Dates with Max Reservations:</strong>
        <ul id="maxReservedDatesList"></ul>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Date</th>
            <th>Time</th>
            <th>Package</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="reservationTableBody">
          <!-- Reservation data will be rendered here dynamically -->
        </tbody>
      </table>
      <a href="./"><h3>me here baby</h3></a>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
        remove,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB-6hbV69tC2QLhJhyy98KM0y2QCsRu-IU",
        authDomain: "logform-d296a.firebaseapp.com",
        databaseURL: "https://logform-d296a-default-rtdb.firebaseio.com",
        projectId: "logform-d296a",
        storageBucket: "logform-d296a.appspot.com",
        messagingSenderId: "455249423966",
        appId: "1:455249423966:web:b67034b8c55430f1e1cecf",
        measurementId: "G-6H8TCVCS1B",
      };

      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const reservationsRef = ref(database, "LOGFORM/reservations");

      const MAX_RESERVATIONS_PER_DAY = 5;

      function getReservedDatesCount(reservations) {
        const reservedDatesCount = {};

        for (const key in reservations) {
          const reservation = reservations[key];
          const reservationDate = reservation.date;

          if (!reservedDatesCount.hasOwnProperty(reservationDate)) {
            reservedDatesCount[reservationDate] = 0;
          }

          reservedDatesCount[reservationDate]++;
        }

        return reservedDatesCount;
      }

      function renderReservations(reservations) {
        const reservationTableBody = document.getElementById(
          "reservationTableBody"
        );
        reservationTableBody.innerHTML = "";

        for (const key in reservations) {
          const reservation = reservations[key];
          const row = document.createElement("tr");

          const cells = ["name", "email", "date", "time", "pack"];
          cells.forEach((cell) => {
            const cellElement = document.createElement("td");
            cellElement.textContent = reservation[cell];
            row.appendChild(cellElement);
          });

          const deleteCell = document.createElement("td");
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.classList.add("btn", "btn-danger");
          deleteButton.addEventListener("click", () => {
            deleteReservation(key);
          });
          deleteCell.appendChild(deleteButton);
          row.appendChild(deleteCell);

          reservationTableBody.appendChild(row);
        }

        updateReservedDatesCount(reservations);
      }

      function updateReservedDatesCount(reservations) {
        const reservedDatesCount = getReservedDatesCount(reservations);
        const maxReservedDatesList = document.getElementById(
          "maxReservedDatesList"
        );
        maxReservedDatesList.innerHTML = "";

        const maxReservedDates = Object.keys(reservedDatesCount).filter(
          (date) => reservedDatesCount[date] >= MAX_RESERVATIONS_PER_DAY
        );

        maxReservedDates.forEach((date) => {
          const listItem = document.createElement("li");
          listItem.textContent = date;
          maxReservedDatesList.appendChild(listItem);
        });
      }

      onValue(reservationsRef, (snapshot) => {
        const reservations = snapshot.val();
        renderReservations(reservations);
      });

      function deleteReservation(key) {
        remove(ref(database, `LOGFORM/reservations/${key}`));
      }

      function getCurrentDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, "0");
        const day = String(today.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      function updateTotalCount(reservations) {
        const currentDate = getCurrentDate();
        const totalCountElement = document.getElementById("totalCount");

        const todayReservations = Object.values(reservations || {}).filter(
          (reservation) => reservation.date === currentDate
        );

        totalCountElement.textContent = todayReservations.length;
      }

      onValue(reservationsRef, (snapshot) => {
        const reservations = snapshot.val();
        renderReservations(reservations);
        updateTotalCount(reservations);
      });
    </script>

    <!-- Bootstrap JS (you may need to adjust the path) -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  </body>
</html>
